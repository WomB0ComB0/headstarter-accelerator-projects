"use strict";var W=Object.defineProperty;var Se=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var Re=Object.prototype.hasOwnProperty;var Te=(e,t)=>{for(var r in t)W(e,r,{get:t[r],enumerable:!0})},Pe=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of be(t))!Re.call(e,o)&&o!==r&&W(e,o,{get:()=>t[o],enumerable:!(n=Se(t,o))||n.enumerable});return e};var Oe=e=>Pe(W({},"__esModule",{value:!0}),e);var at={};Te(at,{capitalizeFirstLetter:()=>he,createAuthClient:()=>it,useStore:()=>$});module.exports=Oe(at);var we=Object.defineProperty,_e=Object.defineProperties,Ee=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,xe=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable,Y=(e,t,r)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))xe.call(t,r)&&Y(e,r,t[r]);if(Q)for(var r of Q(t))Ae.call(t,r)&&Y(e,r,t[r]);return e},R=(e,t)=>_e(e,Ee(t)),Ue=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},Le=async(e,t)=>{var r,n,o,a,s,c;let u=t||{},i={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:u,hooks:i};for(let l of t?.plugins||[]){if(l.init){let f=await((r=l.init)==null?void 0:r.call(l,e.toString(),t));u=f.options||u,e=f.url}i.onRequest.push((n=l.hooks)==null?void 0:n.onRequest),i.onResponse.push((o=l.hooks)==null?void 0:o.onResponse),i.onSuccess.push((a=l.hooks)==null?void 0:a.onSuccess),i.onError.push((s=l.hooks)==null?void 0:s.onError),i.onRetry.push((c=l.hooks)==null?void 0:c.onRetry)}return{url:e,options:u,hooks:i}},X=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},Ie=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function ke(e){if(typeof e=="number")return new X({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new X(e);case"exponential":return new Ie(e);default:throw new Error("Invalid retry strategy")}}var Ne=e=>{let t={},r=n=>typeof n=="function"?n():n;if(e?.auth){if(e.auth.type==="Bearer"){let n=r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if(e.auth.type==="Basic"){let n=r(e.auth.username),o=r(e.auth.password);if(!n||!o)return t;t.authorization=`Basic ${btoa(`${n}:${o}`)}`}else if(e.auth.type==="Custom"){let n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},te=["get","post","put","patch","delete"];var Ce=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,r){var n,o,a,s;let c=((o=(n=e.plugins)==null?void 0:n.find(u=>{var i;return(i=u.schema)!=null&&i.config?t.startsWith(u.schema.config.baseURL||"")||t.startsWith(u.schema.config.prefix||""):!1}))==null?void 0:o.schema)||e.schema;if(c){let u=t;(a=c.config)!=null&&a.prefix&&u.startsWith(c.config.prefix)&&(u=u.replace(c.config.prefix,""),c.config.baseURL&&(t=t.replace(c.config.prefix,c.config.baseURL))),(s=c.config)!=null&&s.baseURL&&u.startsWith(c.config.baseURL)&&(u=u.replace(c.config.baseURL,""));let i=c.schema[u];if(i){let l=R(v({},r),{method:i.method,output:i.output});return r?.disableValidation||(l=R(v({},l),{body:i.input?i.input.parse(r?.body):r?.body,params:i.params?i.params.parse(r?.params):r?.params,query:i.query?i.query.parse(r?.query):r?.query})),{url:t,options:l}}}return{url:t,options:r}}}),re=e=>{async function t(r,n){let o=R(v(v({},e),n),{plugins:[...e?.plugins||[],Ce(e||{})]});if(e?.catchAllError)try{return await V(r,o)}catch(a){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:a}}}return await V(r,o)}return t},Be=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Fe(e){let t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";let n=t.split(";").shift()||"";return Be.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}function De(e){try{return JSON.parse(e),!0}catch{return!1}}function ne(e){if(e===void 0)return!1;let t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function Z(e){try{return JSON.parse(e)}catch{return e}}function ee(e){return typeof e=="function"}function je(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&ee(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&ee(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}function qe(e){let t=new Headers(e?.headers),r=Ne(e);for(let[n,o]of Object.entries(r||{}))t.set(n,o);if(!t.has("content-type")){let n=Me(e?.body);n&&t.set("content-type",n)}return t}function Me(e){return ne(e)?"application/json":null}function We(e){if(!e?.body)return null;let t=new Headers(e?.headers);return ne(e.body)&&!t.has("content-type")?JSON.stringify(e.body):e.body}function Ve(e,t){var r;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){let n=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return te.includes(n)?n.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function He(e,t){let r;return!e?.signal&&e?.timeout&&(r=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}function Je(e,t){let{baseURL:r,params:n,query:o}=t||{query:{},params:{},baseURL:""},a=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r;if(!a)throw new TypeError(`Invalid URL ${e}. Are you passing in a relative URL but not setting the baseURL?`);if(e.startsWith("@")){let f=e.toString().split("@")[1].split("/")[0];te.includes(f)&&(e=e.replace(`@${f}/`,"/"))}a.endsWith("/")||(a+="/");let[s,c]=e.replace(a,"").split("?"),u=new URLSearchParams(c);for(let[f,d]of Object.entries(o||{}))u.set(f,String(d));if(n)if(Array.isArray(n)){let f=s.split("/").filter(d=>d.startsWith(":"));for(let[d,p]of f.entries()){let b=n[d];s=s.replace(p,b)}}else for(let[f,d]of Object.entries(n))s=s.replace(`:${f}`,String(d));s=s.split("/").map(encodeURIComponent).join("/"),s.startsWith("/")&&(s=s.slice(1));let i=u.size>0?`?${u}`.replace(/\+/g,"%20"):"";return new URL(`${s}${i}`,a)}var V=async(e,t)=>{var r,n,o,a,s,c,u,i;let{hooks:l,url:f,options:d}=await Le(e,t),p=je(d),b=new AbortController,N=(r=d.signal)!=null?r:b.signal,_=Je(f,d),C=We(d),U=qe(d),E=Ve(f,d),h=R(v({},d),{url:_,headers:U,body:C,method:E,signal:N});for(let g of l.onRequest)if(g){let m=await g(h);m instanceof Object&&(h=m)}("pipeTo"in h&&typeof h.pipeTo=="function"||typeof((n=t?.body)==null?void 0:n.pipe)=="function")&&("duplex"in h||(h.duplex="half"));let{clearTimeout:q}=He(d,b),y=await p(h.url,h);q();let z={response:y,request:h};for(let g of l.onResponse)if(g){let m=await g(R(v({},z),{response:(o=t?.hookOptions)!=null&&o.cloneResponse?y.clone():y}));m instanceof Response?y=m:m instanceof Object&&(y=m.response)}if(y.ok){if(!(h.method!=="HEAD"))return{data:"",error:null};let m=Fe(y),T={data:"",response:y,request:h};if(m==="json"||m==="text"){let P=await y.text(),ve=await((a=h.jsonParser)!=null?a:Z)(P);T.data=ve}else T.data=await y[m]();h?.output&&h.output&&!h.disableValidation&&(T.data=h.output.parse(T.data));for(let P of l.onSuccess)P&&await P(R(v({},T),{response:(s=t?.hookOptions)!=null&&s.cloneResponse?y.clone():y}));return t?.throw?T.data:{data:T.data,error:null}}let me=(c=t?.jsonParser)!=null?c:Z,K=await y.text(),M=De(K)?await me(K):{},ge={response:y,request:h,error:R(v({},M),{status:y.status,statusText:y.statusText})};for(let g of l.onError)g&&await g(R(v({},ge),{response:(u=t?.hookOptions)!=null&&u.cloneResponse?y.clone():y}));if(t?.retry){let g=ke(t.retry),m=(i=t.retryAttempt)!=null?i:0;if(await g.shouldAttemptRetry(m,y)){for(let P of l.onRetry)P&&await P(z);let T=g.getDelay(m);return await new Promise(P=>setTimeout(P,T)),await V(e,R(v({},t),{retryAttempt:m+1}))}}if(t?.throw)throw new Ue(y.status,y.statusText,M);return{data:null,error:R(v({},M),{status:y.status,statusText:y.statusText})}};var B=Object.create(null),L=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?B:globalThis),O=new Proxy(B,{get(e,t){return L()[t]??B[t]},has(e,t){let r=L();return t in r||t in B},set(e,t,r){let n=L(!0);return n[t]=r,!0},deleteProperty(e,t){if(!t)return!1;let r=L(!0);return delete r[t],!0},ownKeys(){let e=L(!0);return Object.keys(e)}});function Ge(e){return e?e!=="false":!1}var $e=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var yt=$e==="test"||Ge(O.TEST);var F=class extends Error{constructor(t,r){super(t),this.name="BetterAuthError",this.message=t,this.cause=r,this.stack=""}};function ze(e){try{return new URL(e).pathname!=="/"}catch{throw new F(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function H(e,t="/api/auth"){return ze(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e.replace(/\/+$/,"")}${t}`)}function oe(e,t){if(e)return H(e,t);let r=O.BETTER_AUTH_URL||O.NEXT_PUBLIC_BETTER_AUTH_URL||O.PUBLIC_BETTER_AUTH_URL||O.NUXT_PUBLIC_BETTER_AUTH_URL||O.NUXT_PUBLIC_AUTH_URL||(O.BASE_URL!=="/"?O.BASE_URL:void 0);if(r)return H(r,t);if(typeof window<"u"&&window.location)return H(window.location.origin,t)}var I=Symbol("clean");var S=[],w=0,D=4,Ke=0,k=e=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},lc:0,listen(n){return r.lc=t.push(n),()=>{for(let a=w+D;a<S.length;)S[a]===n?S.splice(a,D):a+=D;let o=t.indexOf(n);~o&&(t.splice(o,1),--r.lc||r.off())}},notify(n,o){Ke++;let a=!S.length;for(let s of t)S.push(s,r.value,n,o);if(a){for(w=0;w<S.length;w+=D)S[w](S[w+1],S[w+2],S[w+3]);S.length=0}},off(){},set(n){let o=r.value;o!==n&&(r.value=n,r.notify(o))},subscribe(n){let o=r.listen(n);return n(r.value),o},value:e};return process.env.NODE_ENV!=="production"&&(r[I]=()=>{t=[],r.lc=0,r.off()}),r};var Qe=5,x=6,j=10,Ye=(e,t,r,n)=>(e.events=e.events||{},e.events[r+j]||(e.events[r+j]=n(o=>{e.events[r].reduceRight((a,s)=>(s(a),a),{shared:{},...o})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let o=e.events[r],a=o.indexOf(t);o.splice(a,1),o.length||(delete e.events[r],e.events[r+j](),delete e.events[r+j])});var se=1e3,J=(e,t)=>Ye(e,n=>{let o=t(n);o&&e.events[x].push(o)},Qe,n=>{let o=e.listen;e.listen=(...s)=>(!e.lc&&!e.active&&(e.active=!0,n()),o(...s));let a=e.off;if(e.events[x]=[],e.off=()=>{a(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let s of e.events[x])s();e.events[x]=[]}},se)},process.env.NODE_ENV!=="production"){let s=e[I];e[I]=()=>{for(let c of e.events[x])c();e.events[x]=[],e.active=!1,s()}}return()=>{e.listen=o,e.off=a}});function G(e,t,r){let n=new Set([...t,void 0]);return e.listen((o,a,s)=>{n.has(s)&&r(o,a,s)})}var ie={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},ae={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};var le=(e,t,r,n)=>{let o=k({data:null,error:null,isPending:!0,isRefetching:!1}),a=()=>{let c=typeof n=="function"?n({data:o.get().data,error:o.get().error,isPending:o.get().isPending}):n;return r(t,{...c,async onSuccess(u){typeof window<"u"&&o.set({data:u.data,error:null,isPending:!1,isRefetching:!1}),await c?.onSuccess?.(u)},async onError(u){let{request:i}=u,l=typeof i.retry=="number"?i.retry:i.retry?.attempts,f=i.retryAttempt||0;l&&f<l||(o.set({error:u.error,data:null,isPending:!1,isRefetching:!1}),await c?.onError?.(u))},async onRequest(u){let i=o.get();o.set({isPending:i.data===null,data:i.data,error:null,isRefetching:!0}),await c?.onRequest?.(u)}})};e=Array.isArray(e)?e:[e];let s=!1;for(let c of e)c.subscribe(()=>{s?a():J(o,()=>(a(),s=!0,()=>{o.off(),c.off()}))});return o};function ue(e){let t=k(!1);return{session:le(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var Xe={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},Ze=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,ce={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},et=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function tt(e){return e instanceof Date&&!isNaN(e.getTime())}function rt(e){let t=et.exec(e);if(!t)return null;let[,r,n,o,a,s,c,u,i,l,f]=t,d=new Date(Date.UTC(parseInt(r,10),parseInt(n,10)-1,parseInt(o,10),parseInt(a,10),parseInt(s,10),parseInt(c,10),u?parseInt(u.padEnd(3,"0"),10):0));if(i){let p=(parseInt(l,10)*60+parseInt(f,10))*(i==="+"?-1:1);d.setUTCMinutes(d.getUTCMinutes()+p)}return tt(d)?d:null}function nt(e,t={}){let{strict:r=!1,warnings:n=!1,reviver:o,parseDates:a=!0}=t;if(typeof e!="string")return e;let s=e.trim();if(s[0]==='"'&&s.endsWith('"')&&!s.slice(1,-1).includes('"'))return s.slice(1,-1);let c=s.toLowerCase();if(c.length<=9&&c in ce)return ce[c];if(!Ze.test(s)){if(r)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(Xe).some(([i,l])=>{let f=l.test(s);return f&&n&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${i} pattern`),f})&&r)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(s,(l,f)=>{if(l==="__proto__"||l==="constructor"&&f&&typeof f=="object"&&"prototype"in f){n&&console.warn(`[better-json] Dropping "${l}" key to prevent prototype pollution`);return}if(a&&typeof f=="string"){let d=rt(f);if(d)return d}return o?o(l,f):f})}catch(i){if(r)throw i;return e}}function fe(e,t={strict:!0}){return nt(e,t)}var pe=e=>{let t="credentials"in Request.prototype,r=oe(e?.baseURL),n=e?.plugins?.flatMap(p=>p.fetchPlugins).filter(p=>p!==void 0)||[],o=re({baseURL:r,...t?{credentials:"include"}:{},method:"GET",jsonParser(p){return fe(p,{strict:!1})},customFetchImpl:async(p,b)=>{try{return await fetch(p,b)}catch{return Response.error()}},...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...n]:[ie,ae,...e?.fetchOptions?.plugins||[],...n]}),{$sessionSignal:a,session:s}=ue(o),c=e?.plugins||[],u={},i={$sessionSignal:a,session:s},l={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"},f=[{signal:"$sessionSignal",matcher(p){return p==="/sign-out"||p==="/update-user"||p.startsWith("/sign-in")||p.startsWith("/sign-up")}}];for(let p of c)p.getAtoms&&Object.assign(i,p.getAtoms?.(o)),p.pathMethods&&Object.assign(l,p.pathMethods),p.atomListeners&&f.push(...p.atomListeners);let d={notify:p=>{i[p].set(!i[p].get())},listen:(p,b)=>{i[p].subscribe(b)},atoms:i};for(let p of c)p.getActions&&Object.assign(u,p.getActions?.(o,d));return{pluginsActions:u,pluginsAtoms:i,pluginPathMethods:l,atomListeners:f,$fetch:o,$store:d}};function ot(e,t,r){let n=t[e],{fetchOptions:o,query:a,...s}=r||{};return n||(o?.method?o.method:s&&Object.keys(s).length>0?"POST":"GET")}function de(e,t,r,n,o){function a(s=[]){return new Proxy(function(){},{get(c,u){let i=[...s,u],l=e;for(let f of i)if(l&&typeof l=="object"&&f in l)l=l[f];else{l=void 0;break}return typeof l=="function"?l:a(i)},apply:async(c,u,i)=>{let l="/"+s.map(U=>U.replace(/[A-Z]/g,E=>`-${E.toLowerCase()}`)).join("/"),f=i[0]||{},d=i[1]||{},{query:p,fetchOptions:b,...N}=f,_={...d,...b},C=ot(l,r,f);return await t(l,{..._,body:C==="GET"?void 0:{...N,..._?.body||{}},query:p||_?.query,method:C,async onSuccess(U){await _?.onSuccess?.(U);let E=o?.find(y=>y.matcher(l));if(!E)return;let h=n[E.signal];if(!h)return;let q=h.get();setTimeout(()=>{h.set(!q)},10)}})}})}return a()}var A=require("react"),ye=(e,t)=>r=>{e.current=r,t()};function $(e,{keys:t,deps:r=[e,t]}={}){let n=(0,A.useRef)();n.current=e.get();let o=(0,A.useCallback)(s=>(t?.length||0)>0?G(e,t,ye(n,s)):e.listen(ye(n,s)),r),a=()=>n.current;return(0,A.useSyncExternalStore)(o,a,a)}function st(e){return`use${he(e)}`}function he(e){return e.charAt(0).toUpperCase()+e.slice(1)}function it(e){let{pluginPathMethods:t,pluginsActions:r,pluginsAtoms:n,$fetch:o,$store:a,atomListeners:s}=pe(e),c={};for(let[l,f]of Object.entries(n))c[st(l)]=()=>$(f);let u={...r,...c,$fetch:o,$store:a};return de(u,o,t,n,s)}0&&(module.exports={capitalizeFirstLetter,createAuthClient,useStore});
