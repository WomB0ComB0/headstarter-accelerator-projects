var ge=Object.defineProperty,he=Object.defineProperties,ye=Object.getOwnPropertyDescriptors,C=Object.getOwnPropertySymbols,be=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable,j=(e,t,r)=>t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,P=(e,t)=>{for(var r in t||(t={}))be.call(t,r)&&j(e,r,t[r]);if(C)for(var r of C(t))ve.call(t,r)&&j(e,r,t[r]);return e},U=(e,t)=>he(e,ye(t)),_e=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},we=async(e,t)=>{var r,i,o,a,n,c;let l=t||{},s={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:l,hooks:s};for(let d of t?.plugins||[]){if(d.init){let g=await((r=d.init)==null?void 0:r.call(d,e.toString(),t));l=g.options||l,e=g.url}s.onRequest.push((i=d.hooks)==null?void 0:i.onRequest),s.onResponse.push((o=d.hooks)==null?void 0:o.onResponse),s.onSuccess.push((a=d.hooks)==null?void 0:a.onSuccess),s.onError.push((n=d.hooks)==null?void 0:n.onError),s.onRetry.push((c=d.hooks)==null?void 0:c.onRetry)}return{url:e,options:l,hooks:s}},D=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},xe=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function Pe(e){if(typeof e=="number")return new D({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new D(e);case"exponential":return new xe(e);default:throw new Error("Invalid retry strategy")}}var Ue=e=>{let t={},r=i=>typeof i=="function"?i():i;if(e?.auth){if(e.auth.type==="Bearer"){let i=r(e.auth.token);if(!i)return t;t.authorization=`Bearer ${i}`}else if(e.auth.type==="Basic"){let i=r(e.auth.username),o=r(e.auth.password);if(!i||!o)return t;t.authorization=`Basic ${btoa(`${i}:${o}`)}`}else if(e.auth.type==="Custom"){let i=r(e.auth.value);if(!i)return t;t.authorization=`${r(e.auth.prefix)} ${i}`}}return t},M=["get","post","put","patch","delete"];var Re=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Ae(e){let t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";let i=t.split(";").shift()||"";return Re.test(i)?"json":r.has(i)||i.startsWith("text/")?"text":"blob"}function Te(e){try{return JSON.parse(e),!0}catch{return!1}}function G(e){if(e===void 0)return!1;let t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function N(e){try{return JSON.parse(e)}catch{return e}}function V(e){return typeof e=="function"}function ke(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&V(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&V(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}function Le(e){let t=new Headers(e?.headers),r=Ue(e);for(let[i,o]of Object.entries(r||{}))t.set(i,o);if(!t.has("content-type")){let i=Oe(e?.body);i&&t.set("content-type",i)}return t}function Oe(e){return G(e)?"application/json":null}function Ie(e){if(!e?.body)return null;let t=new Headers(e?.headers);return G(e.body)&&!t.has("content-type")?JSON.stringify(e.body):e.body}function Ee(e,t){var r;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){let i=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return M.includes(i)?i.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function Se(e,t){let r;return!e?.signal&&e?.timeout&&(r=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}function ze(e,t){let{baseURL:r,params:i,query:o}=t||{query:{},params:{},baseURL:""},a=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r;if(!a)throw new TypeError(`Invalid URL ${e}. Are you passing in a relative URL but not setting the baseURL?`);if(e.startsWith("@")){let g=e.toString().split("@")[1].split("/")[0];M.includes(g)&&(e=e.replace(`@${g}/`,"/"))}a.endsWith("/")||(a+="/");let[n,c]=e.replace(a,"").split("?"),l=new URLSearchParams(c);for(let[g,h]of Object.entries(o||{}))l.set(g,String(h));if(i)if(Array.isArray(i)){let g=n.split("/").filter(h=>h.startsWith(":"));for(let[h,I]of g.entries()){let k=i[h];n=n.replace(I,k)}}else for(let[g,h]of Object.entries(i))n=n.replace(`:${g}`,String(h));n=n.split("/").map(encodeURIComponent).join("/"),n.startsWith("/")&&(n=n.slice(1));let s=l.size>0?`?${l}`.replace(/\+/g,"%20"):"";return new URL(`${n}${s}`,a)}var u=async(e,t)=>{var r,i,o,a,n,c,l,s;let{hooks:d,url:g,options:h}=await we(e,t),I=ke(h),k=new AbortController,ae=(r=h.signal)!=null?r:k.signal,se=ze(g,h),ce=Ie(h),le=Le(h),ue=Ee(g,h),y=U(P({},h),{url:se,headers:le,body:ce,method:ue,signal:ae});for(let v of d.onRequest)if(v){let b=await v(y);b instanceof Object&&(y=b)}("pipeTo"in y&&typeof y.pipeTo=="function"||typeof((i=t?.body)==null?void 0:i.pipe)=="function")&&("duplex"in y||(y.duplex="half"));let{clearTimeout:de}=Se(h,k),f=await I(y.url,y);de();let $={response:f,request:y};for(let v of d.onResponse)if(v){let b=await v(U(P({},$),{response:(o=t?.hookOptions)!=null&&o.cloneResponse?f.clone():f}));b instanceof Response?f=b:b instanceof Object&&(f=b.response)}if(f.ok){if(!(y.method!=="HEAD"))return{data:"",error:null};let b=Ae(f),w={data:"",response:f,request:y};if(b==="json"||b==="text"){let x=await f.text(),me=await((a=y.jsonParser)!=null?a:N)(x);w.data=me}else w.data=await f[b]();y?.output&&y.output&&!y.disableValidation&&(w.data=y.output.parse(w.data));for(let x of d.onSuccess)x&&await x(U(P({},w),{response:(n=t?.hookOptions)!=null&&n.cloneResponse?f.clone():f}));return t?.throw?w.data:{data:w.data,error:null}}let pe=(c=t?.jsonParser)!=null?c:N,B=await f.text(),E=Te(B)?await pe(B):{},fe={response:f,request:y,error:U(P({},E),{status:f.status,statusText:f.statusText})};for(let v of d.onError)v&&await v(U(P({},fe),{response:(l=t?.hookOptions)!=null&&l.cloneResponse?f.clone():f}));if(t?.retry){let v=Pe(t.retry),b=(s=t.retryAttempt)!=null?s:0;if(await v.shouldAttemptRetry(b,f)){for(let x of d.onRetry)x&&await x($);let w=v.getDelay(b);return await new Promise(x=>setTimeout(x,w)),await u(e,U(P({},t),{retryAttempt:b+1}))}}if(t?.throw)throw new _e(f.status,f.statusText,E);return{data:null,error:U(P({},E),{status:f.status,statusText:f.statusText})}};import{APIError as Me}from"better-call";import{decodeJwt as Ge,decodeProtectedHeader as He,importJWK as Fe,jwtVerify as qe}from"jose";var H=(e,t="ms")=>new Date(Date.now()+(t==="sec"?e*1e3:e));import{createHash as $e}from"@better-auth/utils/hash";import{base64Url as Be}from"@better-auth/utils/base64";async function F(e){let t=await $e("SHA-256").digest(e);return Be.encode(new Uint8Array(t),{padding:!1})}function L(e){return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?H(e.expires_in,"sec"):void 0,scopes:e?.scope?typeof e.scope=="string"?e.scope.split(" "):e.scope:[],idToken:e.id_token}}async function m({id:e,options:t,authorizationEndpoint:r,state:i,codeVerifier:o,scopes:a,claims:n,redirectURI:c,duration:l}){let s=new URL(r);if(s.searchParams.set("response_type","code"),s.searchParams.set("client_id",t.clientId),s.searchParams.set("state",i),s.searchParams.set("scope",a.join(" ")),s.searchParams.set("redirect_uri",t.redirectURI||c),o){let d=await F(o);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",d)}if(n){let d=n.reduce((g,h)=>(g[h]=null,g),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...d}}))}return l&&s.searchParams.set("duration",l),s}import{jwtVerify as _t}from"jose";async function p({code:e,codeVerifier:t,redirectURI:r,options:i,tokenEndpoint:o,authentication:a}){let n=new URLSearchParams,c={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth"};if(n.set("grant_type","authorization_code"),n.set("code",e),t&&n.set("code_verifier",t),n.set("redirect_uri",r),a==="basic"){let g=btoa(`${i.clientId}:${i.clientSecret}`);c.authorization=`Basic ${g}`}else n.set("client_id",i.clientId),n.set("client_secret",i.clientSecret);let{data:l,error:s}=await u(o,{method:"POST",body:n,headers:c});if(s)throw s;return L(l)}import{z as ur}from"zod";import{APIError as pr}from"better-call";var O=Object.create(null),T=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?O:globalThis),q=new Proxy(O,{get(e,t){return T()[t]??O[t]},has(e,t){let r=T();return t in r||t in O},set(e,t,r){let i=T(!0);return i[t]=r,!0},deleteProperty(e,t){if(!t)return!1;let r=T(!0);return delete r[t],!0},ownKeys(){let e=T(!0);return Object.keys(e)}});function Ce(e){return e?e!=="false":!1}var je=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var xt=je==="test"||Ce(q.TEST);var R=class extends Error{constructor(t,r){super(t),this.name="BetterAuthError",this.message=t,this.cause=r,this.stack=""}};import{createHash as Wt}from"@better-auth/utils/hash";import{xchacha20poly1305 as Kt}from"@noble/ciphers/chacha";import{bytesToHex as Xt,hexToBytes as Zt,utf8ToBytes as Yt}from"@noble/ciphers/utils";import{managedNonce as tr}from"@noble/ciphers/webcrypto";import{createHash as It}from"@better-auth/utils/hash";import{SignJWT as zt}from"jose";import{scryptAsync as jt}from"@noble/hashes/scrypt";import{getRandomValues as Nt}from"uncrypto";import{hex as Mt}from"@better-auth/utils/hex";import{createRandomStringGenerator as Ne}from"@better-auth/utils/random";var Ve=Ne("a-z","0-9","A-Z","-_");var W=e=>{let t="https://appleid.apple.com/auth/token";return{id:"apple",name:"Apple",createAuthorizationURL({state:r,scopes:i,redirectURI:o}){let a=i||["email","name"];return e.scope&&a.push(...e.scope),new URL(`https://appleid.apple.com/auth/authorize?client_id=${e.clientId}&response_type=code&redirect_uri=${e.redirectURI||o}&scope=${a.join(" ")}&state=${r}&response_mode=form_post`)},validateAuthorizationCode:async({code:r,codeVerifier:i,redirectURI:o})=>p({code:r,codeVerifier:i,redirectURI:e.redirectURI||o,options:e,tokenEndpoint:t}),async verifyIdToken(r,i){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(r,i);let o=He(r),{kid:a,alg:n}=o;if(!a||!n)return!1;let c=await We(a),{payload:l}=await qe(r,c,{algorithms:[n],issuer:"https://appleid.apple.com",audience:e.appBundleIdentifier||e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(s=>{l[s]!==void 0&&(l[s]=!!l[s])}),i&&l.nonce!==i?!1:!!l},async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);if(!r.idToken)return null;let i=Ge(r.idToken);if(!i)return null;let o=i.user?`${i.user.name.firstName} ${i.user.name.lastName}`:i.email,a=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:o,emailVerified:!1,email:i.email,...a},data:i}}}},We=async e=>{let t="https://appleid.apple.com",r="/auth/keys",{data:i}=await u(`${t}${r}`);if(!i?.keys)throw new Me("BAD_REQUEST",{message:"Keys not found"});let o=i.keys.find(a=>a.kid===e);if(!o)throw new Error(`JWK with kid ${e} not found`);return await Fe(o,o.alg)};var J=e=>({id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:r,redirectURI:i}){let o=r||["identify","email"];return e.scope&&o.push(...e.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||i)}&state=${t}&prompt=${e.prompt||"none"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>p({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${t.accessToken}`}});if(i)return null;if(r.avatar===null){let a=r.discriminator==="0"?Number(BigInt(r.id)>>BigInt(22))%6:parseInt(r.discriminator)%5;r.image_url=`https://cdn.discordapp.com/embed/avatars/${a}.png`}else{let a=r.avatar.startsWith("a_")?"gif":"png";r.image_url=`https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${a}`}let o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.display_name||r.username||"",email:r.email,emailVerified:r.verified,image:r.image_url,...o},data:r}}});var K=e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:t,scopes:r,redirectURI:i}){let o=r||["email","public_profile"];return e.scope&&o.push(...e.scope),await m({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:o,state:t,redirectURI:i})},validateAuthorizationCode:async({code:t,redirectURI:r})=>p({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let r=["id","name","email","picture",...e?.fields||[]],{data:i,error:o}=await u("https://graph.facebook.com/me?fields="+r.join(","),{auth:{type:"Bearer",token:t.accessToken}});if(o)return null;let a=await e.mapProfileToUser?.(i);return{user:{id:i.id,name:i.name,email:i.email,image:i.picture.data.url,emailVerified:i.email_verified,...a},data:i}}});var Q=e=>{let t="https://github.com/login/oauth/access_token";return{id:"github",name:"GitHub",createAuthorizationURL({state:r,scopes:i,codeVerifier:o,redirectURI:a}){let n=i||["user:email"];return e.scope&&n.push(...e.scope),m({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:n,state:r,redirectURI:a})},validateAuthorizationCode:async({code:r,redirectURI:i})=>p({code:r,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:t}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:i,error:o}=await u("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${r.accessToken}`}});if(o)return null;let a=!1,{data:n}=await u("https://api.github.com/user/emails",{headers:{authorization:`Bearer ${r.accessToken}`,"User-Agent":"better-auth"}});n&&(i.email=(n.find(l=>l.primary)??n[0])?.email,a=n.find(l=>l.email===i.email)?.verified??!1);let c=await e.mapProfileToUser?.(i);return{user:{id:i.id.toString(),name:i.name||i.login,email:i.email,image:i.avatar_url,emailVerified:a,...c},data:i}}}};import{decodeJwt as Ze}from"jose";var S=["info","success","warn","error","debug"];function Je(e,t){return S.indexOf(t)<=S.indexOf(e)}var _={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},Ke={info:_.fg.blue,success:_.fg.green,warn:_.fg.yellow,error:_.fg.red,debug:_.fg.magenta},Qe=(e,t)=>{let r=new Date().toISOString();return`${_.dim}${r}${_.reset} ${Ke[e]}${e.toUpperCase()}${_.reset} ${_.bright}[Better Auth]:${_.reset} ${t}`},Xe=e=>{let t=e?.disabled!==!0,r=e?.level??"error",i=(o,a,n=[])=>{if(!t||!Je(r,o))return;let c=Qe(o,a);if(!e||typeof e.log!="function"){o==="error"?console.error(c,...n):o==="warn"?console.warn(c,...n):console.log(c,...n);return}e.log(o==="success"?"info":o,a,...n)};return Object.fromEntries(S.map(o=>[o,(...[a,...n])=>i(o,a,n)]))},A=Xe();var X=e=>({id:"google",name:"Google",async createAuthorizationURL({state:t,scopes:r,codeVerifier:i,redirectURI:o}){if(!e.clientId||!e.clientSecret)throw A.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new R("CLIENT_ID_AND_SECRET_REQUIRED");if(!i)throw new R("codeVerifier is required for Google");let a=r||["email","profile","openid"];e.scope&&a.push(...e.scope);let n=await m({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:a,state:t,codeVerifier:i,redirectURI:o});return e.accessType&&n.searchParams.set("access_type",e.accessType),e.prompt&&n.searchParams.set("prompt",e.prompt),e.display&&n.searchParams.set("display",e.display),e.hd&&n.searchParams.set("hd",e.hd),n},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:i})=>p({code:t,codeVerifier:r,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);let i=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`,{data:o}=await u(i);return o?o.aud===e.clientId&&o.iss==="https://accounts.google.com":!1},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let r=Ze(t.idToken),i=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:r.email_verified,...i},data:r}}});import{decodeJwt as Ye}from"jose";var Z=e=>{let t=e.tenantId||"common",r=`https://login.microsoftonline.com/${t}/oauth2/v2.0/authorize`,i=`https://login.microsoftonline.com/${t}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(o){let a=o.scopes||["openid","profile","email","User.Read"];return e.scope&&a.push(...e.scope),m({id:"microsoft",options:e,authorizationEndpoint:r,state:o.state,codeVerifier:o.codeVerifier,scopes:a,redirectURI:o.redirectURI})},validateAuthorizationCode({code:o,codeVerifier:a,redirectURI:n}){return p({code:o,codeVerifier:a,redirectURI:e.redirectURI||n,options:e,tokenEndpoint:i})},async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);if(!o.idToken)return null;let a=Ye(o.idToken),n=e.profilePhotoSize||48;await u(`https://graph.microsoft.com/v1.0/me/photos/${n}x${n}/$value`,{headers:{Authorization:`Bearer ${o.accessToken}`},async onResponse(l){if(!(e.disableProfilePhoto||!l.response.ok))try{let d=await l.response.clone().arrayBuffer(),g=Buffer.from(d).toString("base64");a.picture=`data:image/jpeg;base64, ${g}`}catch(s){A.error(s&&typeof s=="object"&&"name"in s?s.name:"",s)}}});let c=await e.mapProfileToUser?.(a);return{user:{id:a.sub,name:a.name,email:a.email,image:a.picture,emailVerified:!0,...c},data:a}}}};var Y=e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:r,codeVerifier:i,redirectURI:o}){let a=r||["user-read-email"];return e.scope&&a.push(...e.scope),m({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:a,state:t,codeVerifier:i,redirectURI:o})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:i})=>p({code:t,codeVerifier:r,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(i)return null;let o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.display_name,email:r.email,image:r.images[0]?.url,emailVerified:!1,...o},data:r}}});import{createRandomStringGenerator as ei}from"@better-auth/utils/random";import{decodeJwt as et}from"jose";var ee=e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:r,redirectURI:i}){let o=r||["user:read:email","openid"];return e.scope&&o.push(...e.scope),m({id:"twitch",redirectURI:i,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:o,state:t,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:t,redirectURI:r})=>p({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let r=t.idToken;if(!r)return A.error("No idToken found in token"),null;let i=et(r),o=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:i.preferred_username,email:i.email,image:i.picture,emailVerified:!1,...o},data:i}}});var te=e=>({id:"twitter",name:"Twitter",createAuthorizationURL(t){let r=t.scopes||["users.read","tweet.read","offline.access"];return e.scope&&r.push(...e.scope),m({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:r,state:t.state,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:i})=>p({code:t,codeVerifier:r,authentication:"basic",redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(i)return null;let o=await e.mapProfileToUser?.(r);return{user:{id:r.data.id,name:r.data.name,email:r.data.username||null,image:r.data.profile_image_url,emailVerified:r.data.verified||!1,...o},data:r}}});var re=e=>{let t="https://api.dropboxapi.com/oauth2/token";return{id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:r,scopes:i,codeVerifier:o,redirectURI:a})=>{let n=i||["account_info.read"];return e.scope&&n.push(...e.scope),await m({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:n,state:r,redirectURI:a,codeVerifier:o})},validateAuthorizationCode:async({code:r,codeVerifier:i,redirectURI:o})=>await p({code:r,codeVerifier:i,redirectURI:e.redirectURI||o,options:e,tokenEndpoint:t}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:i,error:o}=await u("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${r.accessToken}`}});if(o)return null;let a=await e.mapProfileToUser?.(i);return{user:{id:i.account_id,name:i.name?.display_name,email:i.email,emailVerified:i.email_verified||!1,image:i.profile_photo_url,...a},data:i}}}};var ie=e=>{let t="https://www.linkedin.com/oauth/v2/authorization",r="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:i,scopes:o,redirectURI:a})=>{let n=o||["profile","email","openid"];return e.scope&&n.push(...e.scope),await m({id:"linkedin",options:e,authorizationEndpoint:t,scopes:n,state:i,redirectURI:a})},validateAuthorizationCode:async({code:i,redirectURI:o})=>await p({code:i,redirectURI:e.redirectURI||o,options:e,tokenEndpoint:r}),async getUserInfo(i){let{data:o,error:a}=await u("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${i.accessToken}`}});if(a)return null;let n=await e.mapProfileToUser?.(o);return{user:{id:o.sub,name:o.name,email:o.email,emailVerified:o.email_verified||!1,image:o.picture,...n},data:o}}}};var z=(e="")=>e.split("://").map(t=>t.replace(/\/{2,}/g,"/")).join("://"),tt=e=>{let t=e||"https://gitlab.com";return{authorizationEndpoint:z(`${t}/oauth/authorize`),tokenEndpoint:z(`${t}/oauth/token`),userinfoEndpoint:z(`${t}/api/v4/user`)}},oe=e=>{let{authorizationEndpoint:t,tokenEndpoint:r,userinfoEndpoint:i}=tt(e.issuer),o="gitlab";return{id:o,name:"Gitlab",createAuthorizationURL:async({state:n,scopes:c,codeVerifier:l,redirectURI:s})=>{let d=c||["read_user"];return e.scope&&d.push(...e.scope),await m({id:o,options:e,authorizationEndpoint:t,scopes:d,state:n,redirectURI:s,codeVerifier:l})},validateAuthorizationCode:async({code:n,redirectURI:c,codeVerifier:l})=>p({code:n,redirectURI:e.redirectURI||c,options:e,codeVerifier:l,tokenEndpoint:r}),async getUserInfo(n){if(e.getUserInfo)return e.getUserInfo(n);let{data:c,error:l}=await u(i,{headers:{authorization:`Bearer ${n.accessToken}`}});if(l||c.state!=="active"||c.locked)return null;let s=await e.mapProfileToUser?.(c);return{user:{id:c.id.toString(),name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:!0,...s},data:c}}}};var ne=e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:t,scopes:r,redirectURI:i}){let o=r||["identity"];return e.scope&&o.push(...e.scope),m({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:o,state:t,redirectURI:i,duration:e.duration})},validateAuthorizationCode:async({code:t,redirectURI:r})=>{let i=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.redirectURI||r}),o={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${Buffer.from(`${e.clientId}:${e.clientSecret}`).toString("base64")}`},{data:a,error:n}=await u("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:o,body:i.toString()});if(n)throw n;return L(a)},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});if(i)return null;let o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name,email:r.oauth_client_id,emailVerified:r.has_verified_email,image:r.icon_img?.split("?")[0],...o},data:r}}});import{z as rt}from"zod";var it={apple:W,discord:J,facebook:K,github:Q,microsoft:Z,google:X,spotify:Y,twitch:ee,twitter:te,dropbox:re,linkedin:ie,gitlab:oe,reddit:ne},ot=Object.keys(it),Mi=rt.enum(ot,{description:"OAuth2 provider to use"});export{Mi as SocialProviderListEnum,W as apple,J as discord,re as dropbox,K as facebook,We as getApplePublicKey,Q as github,oe as gitlab,X as google,ie as linkedin,Z as microsoft,ne as reddit,ot as socialProviderList,it as socialProviders,Y as spotify,ee as twitch,te as twitter};
