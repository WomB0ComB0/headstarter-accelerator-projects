"use strict";var b=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var D=(e,t)=>{for(var r in t)b(e,r,{get:t[r],enumerable:!0})},M=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of N(t))!z.call(e,n)&&n!==r&&b(e,n,{get:()=>t[n],enumerable:!(s=F(t,n))||s.enumerable});return e};var j=e=>M(b({},"__esModule",{value:!0}),e);var de={};D(de,{InferServerPlugin:()=>w,adminClient:()=>ne,anonymousClient:()=>te,customSessionClient:()=>ce,emailOTPClient:()=>ae,genericOAuthClient:()=>oe,getPasskeyActions:()=>I,inferAdditionalFields:()=>re,jwtClient:()=>se,magicLinkClient:()=>Z,multiSessionClient:()=>ie,oidcClient:()=>fe,oneTapClient:()=>le,organizationClient:()=>Q,passkeyClient:()=>Y,phoneNumberClient:()=>ee,ssoClient:()=>pe,twoFactorClient:()=>X,usernameClient:()=>K});module.exports=j(de);var g=Symbol("clean");var u=[],f=0,S=4,$=0,p=e=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},lc:0,listen(s){return r.lc=t.push(s),()=>{for(let o=f+S;o<u.length;)u[o]===s?u.splice(o,S):o+=S;let n=t.indexOf(s);~n&&(t.splice(n,1),--r.lc||r.off())}},notify(s,n){$++;let o=!u.length;for(let a of t)u.push(a,r.value,s,n);if(o){for(f=0;f<u.length;f+=S)u[f](u[f+1],u[f+2],u[f+3]);u.length=0}},off(){},set(s){let n=r.value;n!==s&&(r.value=s,r.notify(n))},subscribe(s){let n=r.listen(s);return s(r.value),n},value:e};return process.env.NODE_ENV!=="production"&&(r[g]=()=>{t=[],r.lc=0,r.off()}),r};var q=5,m=6,v=10,G=(e,t,r,s)=>(e.events=e.events||{},e.events[r+v]||(e.events[r+v]=s(n=>{e.events[r].reduceRight((o,a)=>(a(o),o),{shared:{},...n})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let n=e.events[r],o=n.indexOf(t);n.splice(o,1),n.length||(delete e.events[r],e.events[r+v](),delete e.events[r+v])});var E=1e3,R=(e,t)=>G(e,s=>{let n=t(s);n&&e.events[m].push(n)},q,s=>{let n=e.listen;e.listen=(...a)=>(!e.lc&&!e.active&&(e.active=!0,s()),n(...a));let o=e.off;if(e.events[m]=[],e.off=()=>{o(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let a of e.events[m])a();e.events[m]=[]}},E)},process.env.NODE_ENV!=="production"){let a=e[g];e[g]=()=>{for(let i of e.events[m])i();e.events[m]=[],e.active=!1,a()}}return()=>{e.listen=n,e.off=o}});function _(e){let t=e;return{newRole(r){return W(r)}}}function W(e){return{statements:e,authorize(t,r){for(let[s,n]of Object.entries(t)){let o=e[s];return o?(r==="OR"?n.some(i=>o.includes(i)):n.every(i=>o.includes(i)))?{success:!0}:{success:!1,error:`Unauthorized to access resource "${s}"`}:{success:!1,error:`You are not allowed to access resource: ${s}`}}return{success:!1,error:"Not authorized"}}}}var H={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]},A=_(H),C=A.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"]}),k=A.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]}),B=A.newRole({organization:[],member:[],invitation:[]});var T=Object.create(null),h=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?T:globalThis),U=new Proxy(T,{get(e,t){return h()[t]??T[t]},has(e,t){let r=h();return t in r||t in T},set(e,t,r){let s=h(!0);return s[t]=r,!0},deleteProperty(e,t){if(!t)return!1;let r=h(!0);return delete r[t],!0},ownKeys(){let e=h(!0);return Object.keys(e)}});function J(e){return e?e!=="false":!1}var V=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var Le=V==="test"||J(U.TEST);var P=class extends Error{constructor(t,r){super(t),this.name="BetterAuthError",this.message=t,this.cause=r,this.stack=""}};var d=(e,t,r,s)=>{let n=p({data:null,error:null,isPending:!0,isRefetching:!1}),o=()=>{let i=typeof s=="function"?s({data:n.get().data,error:n.get().error,isPending:n.get().isPending}):s;return r(t,{...i,async onSuccess(l){typeof window<"u"&&n.set({data:l.data,error:null,isPending:!1,isRefetching:!1}),await i?.onSuccess?.(l)},async onError(l){let{request:c}=l,O=typeof c.retry=="number"?c.retry:c.retry?.attempts,L=c.retryAttempt||0;O&&L<O||(n.set({error:l.error,data:null,isPending:!1,isRefetching:!1}),await i?.onError?.(l))},async onRequest(l){let c=n.get();n.set({isPending:c.data===null,data:c.data,error:null,isRefetching:!0}),await i?.onRequest?.(l)}})};e=Array.isArray(e)?e:[e];let a=!1;for(let i of e)i.subscribe(()=>{a?o():R(n,()=>(o(),a=!0,()=>{n.off(),i.off()}))});return n};var Qe={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY};var Q=e=>{let t=p(!1),r=p(!1),s=p(!1),n={admin:C,member:B,owner:k,...e?.roles};return{id:"organization",$InferServerPlugin:{},getActions:o=>({$Infer:{ActiveOrganization:{},Organization:{},Invitation:{},Member:{}},organization:{checkRolePermission:a=>{if(Object.keys(a.permission).length>1)throw new P("you can only check one resource permission at a time.");let i=n[a.role];return i?(i?.authorize(a.permission)).success:!1}}}),getAtoms:o=>{let a=d(t,"/organization/list",o,{method:"GET"}),i=d([r],"/organization/get-full-organization",o,()=>({method:"GET"})),l=d([s],"/organization/get-active-member",o,{method:"GET"});return{$listOrg:t,$activeOrgSignal:r,$activeMemberSignal:s,activeOrganization:i,listOrganizations:a,activeMember:l}},pathMethods:{"/organization/get-full-organization":"GET"},atomListeners:[{matcher(o){return o==="/organization/create"||o==="/organization/delete"},signal:"$listOrg"},{matcher(o){return o.startsWith("/organization")},signal:"$activeOrgSignal"},{matcher(o){return o.includes("/organization/update-member-role")},signal:"$activeMemberSignal"}]}};var K=()=>({id:"username",$InferServerPlugin:{}});var y=require("@simplewebauthn/browser");var I=(e,{$listPasskeys:t})=>({signIn:{passkey:async(n,o)=>{let a=await e("/passkey/generate-authenticate-options",{method:"POST",body:{email:n?.email}});if(!a.data)return a;try{let i=await(0,y.startAuthentication)({optionsJSON:a.data,useBrowserAutofill:n?.autoFill}),l=await e("/passkey/verify-authentication",{body:{response:i},...n?.fetchOptions,...o,method:"POST"});if(!l.data)return l}catch{return{data:null,error:{message:"auth cancelled",status:400,statusText:"BAD_REQUEST"}}}}},passkey:{addPasskey:async(n,o)=>{let a=await e("/passkey/generate-register-options",{method:"GET"});if(!a.data)return a;try{let i=await(0,y.startRegistration)({optionsJSON:a.data,useAutoRegister:n?.useAutoRegister}),l=await e("/passkey/verify-registration",{...n?.fetchOptions,...o,body:{response:i,name:n?.name},method:"POST"});if(!l.data)return l;t.set(Math.random())}catch(i){return i instanceof y.WebAuthnError?i.code==="ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED"?{data:null,error:{message:"previously registered",status:400,statusText:"BAD_REQUEST"}}:i.code==="ERROR_CEREMONY_ABORTED"?{data:null,error:{message:"registration cancelled",status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:i.message,status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:i instanceof Error?i.message:"unknown error",status:500,statusText:"INTERNAL_SERVER_ERROR"}}}}},$Infer:{}}),Y=()=>{let e=p();return{id:"passkey",$InferServerPlugin:{},getActions:t=>I(t,{$listPasskeys:e}),getAtoms(t){return{listPasskeys:d(e,"/passkey/list-user-passkeys",t,{method:"GET"}),$listPasskeys:e}},pathMethods:{"/passkey/register":"POST","/passkey/authenticate":"POST"},atomListeners:[{matcher(t){return t==="/passkey/verify-registration"||t==="/passkey/delete-passkey"||t==="/passkey/update-passkey"},signal:"_listPasskeys"}]}};var X=e=>({id:"two-factor",$InferServerPlugin:{},atomListeners:[{matcher:t=>t.startsWith("/two-factor/"),signal:"$sessionSignal"}],pathMethods:{"/two-factor/disable":"POST","/two-factor/enable":"POST","/two-factor/send-otp":"POST","/two-factor/generate-backup-codes":"POST"},fetchPlugins:[{id:"two-factor",name:"two-factor",hooks:{async onSuccess(t){t.data?.twoFactorRedirect&&e?.onTwoFactorRedirect&&await e.onTwoFactorRedirect()}}}]});var Z=()=>({id:"magic-link",$InferServerPlugin:{}});var ee=()=>({id:"phoneNumber",$InferServerPlugin:{},atomListeners:[{matcher(e){return e==="/phone-number/update"||e==="/phone-number/verify"},signal:"$sessionSignal"}]});var te=()=>({id:"anonymous",$InferServerPlugin:{},pathMethods:{"/sign-in/anonymous":"POST"}});var re=e=>({id:"additional-fields-client",$InferServerPlugin:{}});var ne=()=>({id:"better-auth-client",$InferServerPlugin:{},pathMethods:{"/admin/list-users":"GET","/admin/stop-impersonating":"POST"}});var oe=()=>({id:"generic-oauth-client",$InferServerPlugin:{}});var se=()=>({id:"better-auth-client",$InferServerPlugin:{}});var ie=()=>({id:"multi-session",$InferServerPlugin:{},atomListeners:[{matcher(e){return e==="/multi-session/set-active"},signal:"$sessionSignal"}]});var ae=()=>({id:"email-otp",$InferServerPlugin:{}});var x=!1,le=e=>({id:"one-tap",getActions:(t,r)=>({oneTap:async(s,n)=>{if(x){console.warn("A Google One Tap request is already in progress. Please wait.");return}x=!0;try{if(typeof window>"u"||!window.document){console.warn("Google One Tap is only available in browser environments");return}let{autoSelect:o,cancelOnTapOutside:a,context:i}=s??{},l=i??e.context??"signin";await ue(),await new Promise(c=>{window.google?.accounts.id.initialize({client_id:e.clientId,callback:async O=>{await t("/one-tap/callback",{method:"POST",body:{idToken:O.credential},...s?.fetchOptions,...n}),(!s?.fetchOptions&&!n||s?.callbackURL)&&(window.location.href=s?.callbackURL??"/"),c()},auto_select:o,cancel_on_tap_outside:a,context:l}),window.google?.accounts.id.prompt()})}catch(o){throw console.error("Error during Google One Tap flow:",o),o}finally{x=!1}}}),getAtoms(t){return{}}}),ue=()=>new Promise(e=>{if(window.googleScriptInitialized){e();return}let t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>{window.googleScriptInitialized=!0,e()},document.head.appendChild(t)});var ce=()=>w();var w=()=>({id:"infer-server-plugin",$InferServerPlugin:{}});var pe=()=>({id:"sso-client",$InferServerPlugin:{}});var fe=()=>({id:"oidc-client",$InferServerPlugin:{}});0&&(module.exports={InferServerPlugin,adminClient,anonymousClient,customSessionClient,emailOTPClient,genericOAuthClient,getPasskeyActions,inferAdditionalFields,jwtClient,magicLinkClient,multiSessionClient,oidcClient,oneTapClient,organizationClient,passkeyClient,phoneNumberClient,ssoClient,twoFactorClient,usernameClient});
