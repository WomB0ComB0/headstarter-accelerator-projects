"use strict";var W=Object.defineProperty;var ge=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var Re=Object.prototype.hasOwnProperty;var be=(e,t)=>{for(var r in t)W(e,r,{get:t[r],enumerable:!0})},Se=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ve(t))!Re.call(e,s)&&s!==r&&W(e,s,{get:()=>t[s],enumerable:!(n=ge(t,s))||n.enumerable});return e};var Te=e=>Se(W({},"__esModule",{value:!0}),e);var it={};be(it,{createAuthClient:()=>ot});module.exports=Te(it);var S=require("vue");function Pe(e){let t=(0,S.getCurrentInstance)();if(t&&t.proxy){let r=t.proxy;("_nanostores"in r?r._nanostores:r._nanostores=[]).push(e)}}function V(e){let t=(0,S.shallowRef)(),r=e.subscribe(n=>{t.value=n});return(0,S.getCurrentScope)()&&(0,S.onScopeDispose)(r),process.env.NODE_ENV!=="production"?(Pe(e),(0,S.readonly)(t)):t}var Oe=Object.defineProperty,we=Object.defineProperties,_e=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,Ee=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,Y=(e,t,r)=>t in e?Oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,R=(e,t)=>{for(var r in t||(t={}))Ee.call(t,r)&&Y(e,r,t[r]);if(Q)for(var r of Q(t))xe.call(t,r)&&Y(e,r,t[r]);return e},T=(e,t)=>we(e,_e(t)),Ue=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},Ae=async(e,t)=>{var r,n,s,l,i,u;let c=t||{},o={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:c,hooks:o};for(let a of t?.plugins||[]){if(a.init){let f=await((r=a.init)==null?void 0:r.call(a,e.toString(),t));c=f.options||c,e=f.url}o.onRequest.push((n=a.hooks)==null?void 0:n.onRequest),o.onResponse.push((s=a.hooks)==null?void 0:s.onResponse),o.onSuccess.push((l=a.hooks)==null?void 0:l.onSuccess),o.onError.push((i=a.hooks)==null?void 0:i.onError),o.onRetry.push((u=a.hooks)==null?void 0:u.onRetry)}return{url:e,options:c,hooks:o}},X=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},Le=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function Ie(e){if(typeof e=="number")return new X({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new X(e);case"exponential":return new Le(e);default:throw new Error("Invalid retry strategy")}}var Ne=e=>{let t={},r=n=>typeof n=="function"?n():n;if(e?.auth){if(e.auth.type==="Bearer"){let n=r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if(e.auth.type==="Basic"){let n=r(e.auth.username),s=r(e.auth.password);if(!n||!s)return t;t.authorization=`Basic ${btoa(`${n}:${s}`)}`}else if(e.auth.type==="Custom"){let n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},ee=["get","post","put","patch","delete"];var Ce=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,r){var n,s,l,i;let u=((s=(n=e.plugins)==null?void 0:n.find(c=>{var o;return(o=c.schema)!=null&&o.config?t.startsWith(c.schema.config.baseURL||"")||t.startsWith(c.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(u){let c=t;(l=u.config)!=null&&l.prefix&&c.startsWith(u.config.prefix)&&(c=c.replace(u.config.prefix,""),u.config.baseURL&&(t=t.replace(u.config.prefix,u.config.baseURL))),(i=u.config)!=null&&i.baseURL&&c.startsWith(u.config.baseURL)&&(c=c.replace(u.config.baseURL,""));let o=u.schema[c];if(o){let a=T(R({},r),{method:o.method,output:o.output});return r?.disableValidation||(a=T(R({},a),{body:o.input?o.input.parse(r?.body):r?.body,params:o.params?o.params.parse(r?.params):r?.params,query:o.query?o.query.parse(r?.query):r?.query})),{url:t,options:a}}}return{url:t,options:r}}}),te=e=>{async function t(r,n){let s=T(R(R({},e),n),{plugins:[...e?.plugins||[],Ce(e||{})]});if(e?.catchAllError)try{return await H(r,s)}catch(l){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:l}}}return await H(r,s)}return t},ke=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Be(e){let t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";let n=t.split(";").shift()||"";return ke.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}function Fe(e){try{return JSON.parse(e),!0}catch{return!1}}function re(e){if(e===void 0)return!1;let t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function K(e){try{return JSON.parse(e)}catch{return e}}function Z(e){return typeof e=="function"}function De(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&Z(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&Z(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}function je(e){let t=new Headers(e?.headers),r=Ne(e);for(let[n,s]of Object.entries(r||{}))t.set(n,s);if(!t.has("content-type")){let n=qe(e?.body);n&&t.set("content-type",n)}return t}function qe(e){return re(e)?"application/json":null}function Me(e){if(!e?.body)return null;let t=new Headers(e?.headers);return re(e.body)&&!t.has("content-type")?JSON.stringify(e.body):e.body}function We(e,t){var r;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){let n=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return ee.includes(n)?n.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function Ve(e,t){let r;return!e?.signal&&e?.timeout&&(r=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}function He(e,t){let{baseURL:r,params:n,query:s}=t||{query:{},params:{},baseURL:""},l=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r;if(!l)throw new TypeError(`Invalid URL ${e}. Are you passing in a relative URL but not setting the baseURL?`);if(e.startsWith("@")){let f=e.toString().split("@")[1].split("/")[0];ee.includes(f)&&(e=e.replace(`@${f}/`,"/"))}l.endsWith("/")||(l+="/");let[i,u]=e.replace(l,"").split("?"),c=new URLSearchParams(u);for(let[f,d]of Object.entries(s||{}))c.set(f,String(d));if(n)if(Array.isArray(n)){let f=i.split("/").filter(d=>d.startsWith(":"));for(let[d,p]of f.entries()){let m=n[d];i=i.replace(p,m)}}else for(let[f,d]of Object.entries(n))i=i.replace(`:${f}`,String(d));i=i.split("/").map(encodeURIComponent).join("/"),i.startsWith("/")&&(i=i.slice(1));let o=c.size>0?`?${c}`.replace(/\+/g,"%20"):"";return new URL(`${i}${o}`,l)}var H=async(e,t)=>{var r,n,s,l,i,u,c,o;let{hooks:a,url:f,options:d}=await Ae(e,t),p=De(d),m=new AbortController,E=(r=d.signal)!=null?r:m.signal,x=He(f,d),k=Me(d),L=je(d),U=We(f,d),y=T(R({},d),{url:x,headers:L,body:k,method:U,signal:E});for(let v of a.onRequest)if(v){let g=await v(y);g instanceof Object&&(y=g)}("pipeTo"in y&&typeof y.pipeTo=="function"||typeof((n=t?.body)==null?void 0:n.pipe)=="function")&&("duplex"in y||(y.duplex="half"));let{clearTimeout:q}=Ve(d,m),h=await p(y.url,y);q();let G={response:h,request:y};for(let v of a.onResponse)if(v){let g=await v(T(R({},G),{response:(s=t?.hookOptions)!=null&&s.cloneResponse?h.clone():h}));g instanceof Response?h=g:g instanceof Object&&(h=g.response)}if(h.ok){if(!(y.method!=="HEAD"))return{data:"",error:null};let g=Be(h),P={data:"",response:h,request:y};if(g==="json"||g==="text"){let O=await h.text(),me=await((l=y.jsonParser)!=null?l:K)(O);P.data=me}else P.data=await h[g]();y?.output&&y.output&&!y.disableValidation&&(P.data=y.output.parse(P.data));for(let O of a.onSuccess)O&&await O(T(R({},P),{response:(i=t?.hookOptions)!=null&&i.cloneResponse?h.clone():h}));return t?.throw?P.data:{data:P.data,error:null}}let he=(u=t?.jsonParser)!=null?u:K,z=await h.text(),M=Fe(z)?await he(z):{},ye={response:h,request:y,error:T(R({},M),{status:h.status,statusText:h.statusText})};for(let v of a.onError)v&&await v(T(R({},ye),{response:(c=t?.hookOptions)!=null&&c.cloneResponse?h.clone():h}));if(t?.retry){let v=Ie(t.retry),g=(o=t.retryAttempt)!=null?o:0;if(await v.shouldAttemptRetry(g,h)){for(let O of a.onRetry)O&&await O(G);let P=v.getDelay(g);return await new Promise(O=>setTimeout(O,P)),await H(e,T(R({},t),{retryAttempt:g+1}))}}if(t?.throw)throw new Ue(h.status,h.statusText,M);return{data:null,error:T(R({},M),{status:h.status,statusText:h.statusText})}};var B=Object.create(null),I=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?B:globalThis),w=new Proxy(B,{get(e,t){return I()[t]??B[t]},has(e,t){let r=I();return t in r||t in B},set(e,t,r){let n=I(!0);return n[t]=r,!0},deleteProperty(e,t){if(!t)return!1;let r=I(!0);return delete r[t],!0},ownKeys(){let e=I(!0);return Object.keys(e)}});function $e(e){return e?e!=="false":!1}var Je=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var ht=Je==="test"||$e(w.TEST);var F=class extends Error{constructor(t,r){super(t),this.name="BetterAuthError",this.message=t,this.cause=r,this.stack=""}};function Ge(e){try{return new URL(e).pathname!=="/"}catch{throw new F(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function $(e,t="/api/auth"){return Ge(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e.replace(/\/+$/,"")}${t}`)}function ne(e,t){if(e)return $(e,t);let r=w.BETTER_AUTH_URL||w.NEXT_PUBLIC_BETTER_AUTH_URL||w.PUBLIC_BETTER_AUTH_URL||w.NUXT_PUBLIC_BETTER_AUTH_URL||w.NUXT_PUBLIC_AUTH_URL||(w.BASE_URL!=="/"?w.BASE_URL:void 0);if(r)return $(r,t);if(typeof window<"u"&&window.location)return $(window.location.origin,t)}var N=Symbol("clean");var b=[],_=0,D=4,ze=0,C=e=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},lc:0,listen(n){return r.lc=t.push(n),()=>{for(let l=_+D;l<b.length;)b[l]===n?b.splice(l,D):l+=D;let s=t.indexOf(n);~s&&(t.splice(s,1),--r.lc||r.off())}},notify(n,s){ze++;let l=!b.length;for(let i of t)b.push(i,r.value,n,s);if(l){for(_=0;_<b.length;_+=D)b[_](b[_+1],b[_+2],b[_+3]);b.length=0}},off(){},set(n){let s=r.value;s!==n&&(r.value=n,r.notify(s))},subscribe(n){let s=r.listen(n);return n(r.value),s},value:e};return process.env.NODE_ENV!=="production"&&(r[N]=()=>{t=[],r.lc=0,r.off()}),r};var Qe=5,A=6,j=10,Ye=(e,t,r,n)=>(e.events=e.events||{},e.events[r+j]||(e.events[r+j]=n(s=>{e.events[r].reduceRight((l,i)=>(i(l),l),{shared:{},...s})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let s=e.events[r],l=s.indexOf(t);s.splice(l,1),s.length||(delete e.events[r],e.events[r+j](),delete e.events[r+j])});var se=1e3,J=(e,t)=>Ye(e,n=>{let s=t(n);s&&e.events[A].push(s)},Qe,n=>{let s=e.listen;e.listen=(...i)=>(!e.lc&&!e.active&&(e.active=!0,n()),s(...i));let l=e.off;if(e.events[A]=[],e.off=()=>{l(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let i of e.events[A])i();e.events[A]=[]}},se)},process.env.NODE_ENV!=="production"){let i=e[N];e[N]=()=>{for(let u of e.events[A])u();e.events[A]=[],e.active=!1,i()}}return()=>{e.listen=s,e.off=l}});var oe={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},ie={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};var ae=(e,t,r,n)=>{let s=C({data:null,error:null,isPending:!0,isRefetching:!1}),l=()=>{let u=typeof n=="function"?n({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):n;return r(t,{...u,async onSuccess(c){typeof window<"u"&&s.set({data:c.data,error:null,isPending:!1,isRefetching:!1}),await u?.onSuccess?.(c)},async onError(c){let{request:o}=c,a=typeof o.retry=="number"?o.retry:o.retry?.attempts,f=o.retryAttempt||0;a&&f<a||(s.set({error:c.error,data:null,isPending:!1,isRefetching:!1}),await u?.onError?.(c))},async onRequest(c){let o=s.get();s.set({isPending:o.data===null,data:o.data,error:null,isRefetching:!0}),await u?.onRequest?.(c)}})};e=Array.isArray(e)?e:[e];let i=!1;for(let u of e)u.subscribe(()=>{i?l():J(s,()=>(l(),i=!0,()=>{s.off(),u.off()}))});return s};function le(e){let t=C(!1);return{session:ae(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var Xe={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},Ke=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,ue={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},Ze=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function et(e){return e instanceof Date&&!isNaN(e.getTime())}function tt(e){let t=Ze.exec(e);if(!t)return null;let[,r,n,s,l,i,u,c,o,a,f]=t,d=new Date(Date.UTC(parseInt(r,10),parseInt(n,10)-1,parseInt(s,10),parseInt(l,10),parseInt(i,10),parseInt(u,10),c?parseInt(c.padEnd(3,"0"),10):0));if(o){let p=(parseInt(a,10)*60+parseInt(f,10))*(o==="+"?-1:1);d.setUTCMinutes(d.getUTCMinutes()+p)}return et(d)?d:null}function rt(e,t={}){let{strict:r=!1,warnings:n=!1,reviver:s,parseDates:l=!0}=t;if(typeof e!="string")return e;let i=e.trim();if(i[0]==='"'&&i.endsWith('"')&&!i.slice(1,-1).includes('"'))return i.slice(1,-1);let u=i.toLowerCase();if(u.length<=9&&u in ue)return ue[u];if(!Ke.test(i)){if(r)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(Xe).some(([o,a])=>{let f=a.test(i);return f&&n&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${o} pattern`),f})&&r)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(i,(a,f)=>{if(a==="__proto__"||a==="constructor"&&f&&typeof f=="object"&&"prototype"in f){n&&console.warn(`[better-json] Dropping "${a}" key to prevent prototype pollution`);return}if(l&&typeof f=="string"){let d=tt(f);if(d)return d}return s?s(a,f):f})}catch(o){if(r)throw o;return e}}function ce(e,t={strict:!0}){return rt(e,t)}var fe=e=>{let t="credentials"in Request.prototype,r=ne(e?.baseURL),n=e?.plugins?.flatMap(p=>p.fetchPlugins).filter(p=>p!==void 0)||[],s=te({baseURL:r,...t?{credentials:"include"}:{},method:"GET",jsonParser(p){return ce(p,{strict:!1})},customFetchImpl:async(p,m)=>{try{return await fetch(p,m)}catch{return Response.error()}},...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...n]:[oe,ie,...e?.fetchOptions?.plugins||[],...n]}),{$sessionSignal:l,session:i}=le(s),u=e?.plugins||[],c={},o={$sessionSignal:l,session:i},a={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"},f=[{signal:"$sessionSignal",matcher(p){return p==="/sign-out"||p==="/update-user"||p.startsWith("/sign-in")||p.startsWith("/sign-up")}}];for(let p of u)p.getAtoms&&Object.assign(o,p.getAtoms?.(s)),p.pathMethods&&Object.assign(a,p.pathMethods),p.atomListeners&&f.push(...p.atomListeners);let d={notify:p=>{o[p].set(!o[p].get())},listen:(p,m)=>{o[p].subscribe(m)},atoms:o};for(let p of u)p.getActions&&Object.assign(c,p.getActions?.(s,d));return{pluginsActions:c,pluginsAtoms:o,pluginPathMethods:a,atomListeners:f,$fetch:s,$store:d}};function pe(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nt(e,t,r){let n=t[e],{fetchOptions:s,query:l,...i}=r||{};return n||(s?.method?s.method:i&&Object.keys(i).length>0?"POST":"GET")}function de(e,t,r,n,s){function l(i=[]){return new Proxy(function(){},{get(u,c){let o=[...i,c],a=e;for(let f of o)if(a&&typeof a=="object"&&f in a)a=a[f];else{a=void 0;break}return typeof a=="function"?a:l(o)},apply:async(u,c,o)=>{let a="/"+i.map(L=>L.replace(/[A-Z]/g,U=>`-${U.toLowerCase()}`)).join("/"),f=o[0]||{},d=o[1]||{},{query:p,fetchOptions:m,...E}=f,x={...d,...m},k=nt(a,r,f);return await t(a,{...x,body:k==="GET"?void 0:{...E,...x?.body||{}},query:p||x?.query,method:k,async onSuccess(L){await x?.onSuccess?.(L);let U=s?.find(h=>h.matcher(a));if(!U)return;let y=n[U.signal];if(!y)return;let q=y.get();setTimeout(()=>{y.set(!q)},10)}})}})}return l()}function st(e){return`use${pe(e)}`}function ot(e){let{pluginPathMethods:t,pluginsActions:r,pluginsAtoms:n,$fetch:s,$store:l,atomListeners:i}=fe(e),u={};for(let[f,d]of Object.entries(n))u[st(f)]=()=>V(d);function c(f){if(f){let d=V(n.$sessionSignal),p=e?.fetchOptions?.baseURL||e?.baseURL,m=p?new URL(p).pathname:"/api/auth";return m=m==="/"?"/api/auth":m,m=m.endsWith("/")?m.slice(0,-1):m,f(`${m}/get-session`,{ref:d}).then(E=>({data:E.data,isPending:!1,error:E.error}))}return u.useSession()}let o={...r,...u,useSession:c,$fetch:s,$store:l};return de(o,s,t,n,i)}0&&(module.exports={createAuthClient});
