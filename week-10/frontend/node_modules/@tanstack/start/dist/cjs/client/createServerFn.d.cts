import { Constrain, DefaultTransformerParse, DefaultTransformerStringify, Expand, ResolveValidatorInput, TransformerStringify, Validator } from '@tanstack/react-router';
import { AnyMiddleware, MergeAllServerContext, MergeAllValidatorInputs, MergeAllValidatorOutputs } from './createMiddleware.cjs';
export interface JsonResponse<TData> extends Response {
    json: () => Promise<TData>;
}
export type CompiledFetcherFnOptions = {
    method: Method;
    data: unknown;
    headers?: HeadersInit;
    context?: any;
};
export type Fetcher<TMiddlewares, TValidator, TResponse> = {
    url: string;
    __executeServer: (opts: {
        method: Method;
        data: unknown;
        headers?: HeadersInit;
        context?: any;
    }) => Promise<unknown>;
} & FetcherImpl<TMiddlewares, TValidator, TResponse>;
export type FetcherImpl<TMiddlewares, TValidator, TResponse> = undefined extends MergeAllValidatorInputs<TMiddlewares, TValidator> ? (opts?: OptionalFetcherDataOptions<Expand<MergeAllValidatorInputs<TMiddlewares, TValidator>>>) => Promise<FetcherData<TResponse>> : (opts: RequiredFetcherDataOptions<Expand<MergeAllValidatorInputs<TMiddlewares, TValidator>>>) => Promise<FetcherData<TResponse>>;
export type FetcherBaseOptions = {
    headers?: HeadersInit;
};
export interface RequiredFetcherDataOptions<TInput> extends FetcherBaseOptions {
    data: TInput;
}
export interface OptionalFetcherDataOptions<TInput> extends FetcherBaseOptions {
    data?: TInput;
}
export type FetcherData<TResponse> = DefaultTransformerParse<TResponse extends JsonResponse<infer TData> ? TData : TResponse>;
export type RscStream<T> = {
    __cacheState: T;
};
export type Method = 'GET' | 'POST';
export type ServerFn<TMethod, TMiddlewares, TValidator, TResponse> = (ctx: ServerFnCtx<TMethod, TMiddlewares, TValidator>) => Promise<DefaultTransformerStringify<TResponse>> | DefaultTransformerStringify<TResponse>;
export interface ServerFnCtx<TMethod, TMiddlewares, TValidator> {
    method: TMethod;
    data: Expand<MergeAllValidatorOutputs<TMiddlewares, TValidator>>;
    context: Expand<MergeAllServerContext<TMiddlewares>>;
}
export type CompiledFetcherFn<TResponse> = {
    (opts: CompiledFetcherFnOptions & ServerFnBaseOptions<Method>): Promise<TResponse>;
    url: string;
};
type ServerFnBaseOptions<TMethod extends Method = 'GET', TResponse = unknown, TMiddlewares = unknown, TInput = unknown> = {
    method: TMethod;
    validateClient?: boolean;
    middleware?: Constrain<TMiddlewares, ReadonlyArray<AnyMiddleware>>;
    validator?: ConstrainValidator<TInput>;
    extractedFn?: CompiledFetcherFn<TResponse>;
    serverFn?: ServerFn<TMethod, TMiddlewares, TInput, TResponse>;
    filename: string;
    functionId: string;
};
export type ConstrainValidator<TValidator> = unknown extends TValidator ? TValidator : Constrain<TValidator, Validator<TransformerStringify<ResolveValidatorInput<TValidator>, Date | undefined | FormData>, any>>;
export interface ServerFnMiddleware<TMethod extends Method, TValidator> {
    middleware: <const TNewMiddlewares = undefined>(middlewares: Constrain<TNewMiddlewares, ReadonlyArray<AnyMiddleware>>) => ServerFnAfterMiddleware<TMethod, TNewMiddlewares, TValidator>;
}
export interface ServerFnAfterMiddleware<TMethod extends Method, TMiddlewares, TValidator> extends ServerFnValidator<TMethod, TMiddlewares>, ServerFnHandler<TMethod, TMiddlewares, TValidator> {
}
export interface ServerFnValidator<TMethod extends Method, TMiddlewares> {
    validator: <TValidator>(validator: ConstrainValidator<TValidator>) => ServerFnAfterValidator<TMethod, TMiddlewares, TValidator>;
}
export interface ServerFnAfterValidator<TMethod extends Method, TMiddlewares, TValidator> extends ServerFnMiddleware<TMethod, TValidator>, ServerFnHandler<TMethod, TMiddlewares, TValidator> {
}
export interface ServerFnHandler<TMethod extends Method, TMiddlewares, TValidator> {
    handler: <TNewResponse>(fn?: ServerFn<TMethod, TMiddlewares, TValidator, TNewResponse>) => Fetcher<TMiddlewares, TValidator, TNewResponse>;
}
export interface ServerFnBuilder<TMethod extends Method = 'GET', TResponse = unknown, TMiddlewares = unknown, TValidator = unknown> extends ServerFnMiddleware<TMethod, TValidator>, ServerFnValidator<TMethod, TMiddlewares>, ServerFnHandler<TMethod, TMiddlewares, TValidator> {
    options: ServerFnBaseOptions<TMethod, TResponse, TMiddlewares, TValidator>;
}
export declare function createServerFn<TMethod extends Method, TResponse = unknown, TMiddlewares = undefined, TValidator = undefined>(options?: {
    method: TMethod;
}, __opts?: ServerFnBaseOptions<TMethod, TResponse, TMiddlewares, TValidator>): ServerFnBuilder<TMethod, TResponse, TMiddlewares, TValidator>;
export type MiddlewareOptions = {
    method: Method;
    data: any;
    headers?: HeadersInit;
    sendContext?: any;
    context?: any;
};
export type MiddlewareResult = MiddlewareOptions & {
    result?: unknown;
    error?: unknown;
};
export type NextFn = (ctx: MiddlewareResult) => Promise<MiddlewareResult>;
export type MiddlewareFn = (ctx: MiddlewareOptions & {
    next: NextFn;
}) => Promise<MiddlewareResult>;
export {};
